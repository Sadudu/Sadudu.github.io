<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/favicon.png"/>
	<link rel="shortcut icon" href="/img/favicon.png">
	
			    <title>
    Sadudu实验室
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="Sadudu" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">Sadudu</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/group/" title="作品">
		                作品
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Sadudu" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="QQ" href="https://www.zhihu.com/people/Sadudu/posts" target="_blank" rel="noopener">
                            <i class="icon fa fa-QQ"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(https://i.imgur.com/8dPjOqy.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >世界线变动率探测仪</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h1 id="命运石之门-智能世界线变动率探测仪设计"><a href="#命运石之门-智能世界线变动率探测仪设计" class="headerlink" title="命运石之门-智能世界线变动率探测仪设计"></a>命运石之门-智能世界线变动率探测仪设计</h1><p><div align="left"></div></p>
<h2 id="邂逅"><a href="#邂逅" class="headerlink" title="邂逅"></a>邂逅</h2><p>初识世界线变动率探测仪是在命运石之门一部动漫中，作为一个工科生，从看到那个动漫的时候起心中就萌生出自己终有一天要DIY一个属于自己的世界线变动率探测仪的想法。</p>
<h2 id="Idea"><a href="#Idea" class="headerlink" title="Idea"></a>Idea</h2><p>说做就做，制作之初的设计方案如下：</p>
<blockquote>
<p>辉光管采用价格适中的IN-14</p>
<p>主控采用性能强劲的ARM-COTEX-M3系列的STM32F103C8T6</p>
<p>时钟芯片采用DS3231</p>
<p>升压模块就用我自己独立设计的5V升压模块</p>
<p>板子采用双层结构设计，上层用来驱动辉光管，下层用来做主控板</p>
</blockquote>
<h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><p>方案确定后，便开始进行设计。打开Altium designer 18，新建Schdoc,pcbdoc…一切都信手拈来。按照Sadudu的一贯作风，把所有的元器件都加了3D模型。一方面为了板子美观，另一方面可以很清楚看到元器件的布局，方便设计。</p>
<h3 id="主控板设计"><a href="#主控板设计" class="headerlink" title="主控板设计"></a>主控板设计</h3><p>主控板以基于ARM架构的STM32F103为核心进行设计，为了增加系统的稳定性，模块毫不吝啬的用了4个100uF的钽电解电容，保证电源的足够稳定。外设方面，主要采用了人体感应探头、咪头、蜂鸣器、LED、蓝牙模块、时钟芯片和储存芯片，各个外设的功能如下：</p>
<blockquote>
<p>人体感应探头：感受环境人体活动</p>
<p>咪头：采集声音，用于声控开关</p>
<p>蜂鸣器：整点报时、开机铃声、闹钟铃声</p>
<p>LED：用于点亮辉光管底部</p>
<p>蓝牙模块：用于与手机连接，可以同步时间，设置灯光、咪头灵敏度等等参数</p>
<p>时钟芯片:保证探测仪掉电走时，板子提供的电池可以在断电后继续用数年之久</p>
<p>储存芯片：保证探测仪掉电后继续储存用户的自定义设置参数，如颜色、点亮时间等等</p>
</blockquote>
<p><strong>众所周知，辉光管的寿命非常有限，所以为了让辉光管的使用时间长一些，笔者设计了多种感应电路。当有人体活动的时候，红外探头会检测到人体活动，此时点亮探测仪，开始显示世界线和时间。当有声音发出时，探测仪也会检测到声音变化。值得一提的是，笔者是设计的时候考虑到各种嘈杂环境可能会引起咪头误触发，导致探测仪一直亮，所以笔者写了一个环境自适应算法，能够计算出当前环境噪声的均值和方差，通过算法进行判断。即使在嘈杂的环境中，咪头能够通过学习周围的环境，进行噪声适应，从而使探测仪不至于一直处于点亮状态。</strong> <strong>这样一来，在有人体活动或者是有声音激发的时候，探测仪能够点亮，当环境没有突发声音或者是没有人体活动的时候，探测仪自动熄灭。并且，可以在微信小程序中设置咪头的灵敏度。</strong></p>
<p><img src="https://i.imgur.com/SxXry87.jpg" alt=""></p>
<p><strong>妹子：“那万一我就是想让探测仪一直亮着怎么办？”</strong></p>
<p><strong>Sadudu:“问题不大，噢~不对，没问题！我写个小程序控制不就行了嘛！”为了让世界线探测仪变得更好玩，笔者在小程序中增加了辉光钟常亮的开关。当此开关打开后，辉光钟就不会受传感器限制了，会一直保持常亮状态。</strong></p>
<h3 id="驱动板设计"><a href="#驱动板设计" class="headerlink" title="驱动板设计"></a>驱动板设计</h3><p>接着设计辉光管驱动板。本来是打算用HV57708来驱动辉光管的，但是考虑到8个管子远不止80个个引脚，一片HV57708不够用，同时HV57708体积又太大，势必会影响到整个板子的体积。还有另外很重要的一点，HV57708最高输出电压是80V，是不能够完全关闭辉光管的，这个时候辉光管可能会有讨厌的蓝光，这个缺点直接让我放弃了HV57708。最终采用了74HC595+三极管的方案进行设计。</p>
<p>布局的时候也是花了很大功夫，由于引脚过多，需要用到多个74HC595，所以布线的时候要反复在原理图和PCB中修改引脚，直至芯片完全对称。<br><img src="https://i.imgur.com/RhlhVnQ.jpg" alt=""></p>
<h3 id="升压模块设计"><a href="#升压模块设计" class="headerlink" title="升压模块设计"></a>升压模块设计</h3><p>升压模块就用我自己设计的5V升压170V模块了，一开始还担心带不动，后来焊上去觉得还行。长时间工作虽然有点发热，但是总体表现还算可以。</p>
<p><img src="https://i.imgur.com/TpHyQZs.jpg" alt=""></p>
<h3 id="检查错误"><a href="#检查错误" class="headerlink" title="检查错误"></a>检查错误</h3><p>做硬件和做软件的最大的不同就是，软件可以无成本不断的debug，但是硬件不同。debug一次的成本太高，周期又太长。PCB设计好之后，拿去打样后一旦发现错误，造成的损失要远比软件多太多了。所以笔者不得不仔细对每一个芯片进行检查，不错过任何一个细节。</p>
<p>将主控板和驱动板进行装配，可以非常方便的看到两个板子的相对布局。</p>
<p><img src="https://i.imgur.com/L7IwOjp.jpg" alt=""></p>
<p><img src="https://i.imgur.com/9uDnGQL.jpg" alt=""></p>
<h2 id="Make"><a href="#Make" class="headerlink" title="Make"></a>Make</h2><h4 id="PCB制作"><a href="#PCB制作" class="headerlink" title="PCB制作"></a>PCB制作</h4><p>板子用的沉稳的黑色沉金，寂静黑色透漏出一丝金色。板子上方丝印用的著名作曲家贝多芬的《命运交响曲》的频谱，典雅中不失稳重。</p>
<p><img src="https://i.imgur.com/eUoKqgk.jpg" alt=""></p>
<p><img src="https://i.imgur.com/JwJAZW4.jpg" alt=""></p>
<p>为了方便制作，笔者打了钢网。</p>
<p><img src="https://i.imgur.com/YWFMnT8.jpg" alt=""></p>
<p>接下来就是漫长的焊接，调试过程。。。</p>
<p>经过一整天+一整晚的焊接与调试，一切正常。</p>
<p><img src="https://i.imgur.com/dh4kzQh.jpg" alt=""></p>
<h4 id="外壳制作"><a href="#外壳制作" class="headerlink" title="外壳制作"></a>外壳制作</h4><p>外壳打算制作两个版本，目前已经设计了一个黑胡桃外壳，效果图如下。接下来再设计个拉丝铝合金外壳版本。</p>
<p><img src="https://i.imgur.com/STYQSDN.jpg" alt=""></p>
<p><img src="https://i.imgur.com/KdoSrq6.jpg" alt=""></p>
<p>至此，辉光钟部分设计基本完毕。</p>
<p>由于笔者的强迫症，不想在盒子上放置按键，红外的方式又觉得麻烦，万一遥控器丢了就凉凉，所以笔者选用的是蓝牙4.0方案。辉光钟内部集成了一个蓝牙4.0模块，可以与手机进行连接对辉光钟进行各项设置。</p>
<p>有趣的是，由于不懂小程序开发，笔者去问了一下行内人士写一个蓝牙小程序的报价，结果价格惊人。算了，贫穷使我理智，笔者不得不硬着头皮开始看着官方API和google开始自己动手敲代码，花了两天时间敲出来了个demo版本。<br><img src="https://i.imgur.com/aFIGh0g.jpg" alt=""></p>
<p><img src="https://i.imgur.com/UVGimLH.jpg" alt=""></p>
<p>至此，工程已经基本完工。剩下还有一些优化工作继续。。。。</p>
<p><a href="http://https://www.zhihu.com/people/Sadudu/activities" title="知乎" target="_blank" rel="noopener">知乎：Sadudu</a></p>
<p>公众号:Sadudu</p>
<p>QQ:1025389563</p>
<p>欢迎加入辉光钟技术交流群：152126128</p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 valine -->
<div id="comment">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#comment' ,
        notify: true,
        verify: false,
        app_id: 'your appId',
        app_key: 'your appkey',
        placeholder: 'Please leave your footprints',
        pageSize: '10',
        avatar: '',
        avatar_cdn: 'https://gravatar.loli.net/avatar/'
    });
</script>
</div>
<style>
   #comment{
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>QQ:<a href="tencent://message/?uin=1025389563&Site=http://vps.shuidazhe.com&Menu=yes" style="border-bottom: none;">Sadudu</a></li>
                <li>Email: <a href="mailto:dudulau@qq.com" style="border-bottom: none;">dudulau@qq.com</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2018年Sadudu实验室被第<span id="busuanzi_value_site_pv"></span>次被破门而入</span>
			
        </div>
    </div>
</body>



 	
</html>
